package br.com.ctb.executorsql.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class ConnectionFactory {
	private static final String DRIVER_CLASS = "com.microsoft.sqlserver.jdbc.SQLServerDriver";
	private static final String URL_CONEXAO = "jdbc:sqlserver://%s:%s;DatabaseName=%s";
	private static Connection conx;
	private String nomeServidor;
	private String portaServidor;
	private String nomeBD;
	private String usuarioBD;
	private String senhaUsuaBD;

	public ConnectionFactory(String nomeServidor, String portaServidor, String nomeBD, String usuarioBD,
			String senhaUsuBD) {
		this.nomeServidor = nomeServidor;
		this.portaServidor = portaServidor;
		this.nomeBD = nomeBD;
		this.usuarioBD = usuarioBD;
		this.senhaUsuaBD = senhaUsuBD;
	}

	public Connection getConnection() throws ClassNotFoundException, SQLException {
		if (conx == null) {
			Class.forName(DRIVER_CLASS);
			String urlConx = prepararUrlConexao();
			conx = DriverManager.getConnection(urlConx, this.usuarioBD, this.senhaUsuaBD);
		}

		return conx;
	}
	
	public void limparConexao() {
		conx = null;
	}

	private String prepararUrlConexao() throws SQLException {
		return String.format(URL_CONEXAO, nomeServidor, portaServidor, nomeBD);
	}
}